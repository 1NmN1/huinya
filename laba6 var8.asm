model small
.stack 100h
.data
    prompt db 'Vvedite stroky: $'
    msg db 'Kolichestvo slov: $'
    buffer db 128, ?, 128 dup('$') ; Буфер для ввода строки (макс 128 символов)
    word_count db 0 ; Переменная для хранения количества слов

.code
main proc
    ; Инициализация сегментов
    mov ax, @data
    mov ds, ax
    mov es, ax

    ; Вывод приглашения ко вводу
    mov ah, 9
    lea dx, prompt
    int 21h

    ; Чтение строки с клавиатуры
    mov ah, 0Ah         ; Функция DOS для ввода строки
    lea dx, buffer      ; Указатель на буфер
    int 21h

    ; Подсчет слов в строке
    lea si, buffer + 1  ; Указатель на первый символ введенной строки
    mov cx, 0           ; Счетчик слов
    mov bl, 0           ; Флаг (0 - вне слова, 1 - внутри слова)
    mov al, buffer[1]   ; Загружаем длину строки

count_loop:
    ; Проверяем, достигли ли конца строки
    mov al, [si]        ; Загружаем текущий символ
    cmp al, 13          ; Символ возврата каретки (конец строки)
    je end_count        ; Если достигнут конец строки, выходим из цикла

    cmp al, ' '         ; Проверяем, является ли символ пробелом
    je space_found      ; Если это пробел, переходим к обработке

    ; Если символ - не пробел
    cmp bl, 1           ; Проверяем, находимся ли уже внутри слова
    je skip             ; Если внутри слова, пропускаем

    ; Начало нового слова
    inc cx              ; Увеличиваем счетчик слов
    mov bl, 1           ; Устанавливаем флаг "внутри слова"
    jmp skip

space_found:
    mov bl, 0           ; Сбрасываем флаг "внутри слова"

skip:
    inc si              ; Переход к следующему символу
    jmp count_loop      ; Повторяем цикл

end_count:
    ; Сохраняем результат в word_count
    mov word_count, cl

    ; Вывод результата
    mov ah, 9           ; Функция DOS для вывода строки
    lea dx, msg
    int 21h

    ; Печать количества слов
    mov al, word_count  ; Загружаем количество слов в AL
    add al, '0'         ; Преобразуем число в ASCII символ
    mov dl, al          ; Кладем символ в DL для вывода
    mov ah, 2           ; Функция DOS для вывода символа
    int 21h

    ; Завершение программы
    mov ax, 4C00h       ; Функция DOS для выхода
    int 21h
main endp
end main